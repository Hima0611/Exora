<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Discovery Trends - A World Away</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  </head>
  <body>
    <style>
      /* Import React app header styles */
      :root {
        --color-dark-blue: #0a0d1f;
        --color-text-white: #ffffff;
        --color-button: #007bff;
      }

      .navbar {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 0px 20px;
        background: rgba(10, 13, 31, 0.9);
        backdrop-filter: blur(10px);
        z-index: 100;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .logoContainer {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
      }

      .logoCircle {
        width: 60px;
        height: 60px;
        border: 2px solid var(--color-text-white);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
      }

      .logoSlogan {
        font-size: 0.7rem;
        margin-top: 5px;
        text-align: center;
        color: var(--color-text-white);
      }

      .navLinks {
        list-style: none;
        display: flex;
        gap: 30px;
        margin: 0;
        padding: 0;
      }

      .navLinks a {
        color: var(--color-text-white);
        text-decoration: none;
        font-size: 1.1rem;
        transition: color 0.3s;
        padding: 8px 16px;
        border-radius: 8px;
      }

      .navLinks a:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      .navLinks a.active {
        background: rgba(0, 123, 255, 0.3);
        border: 1px solid rgba(0, 123, 255, 0.5);
      }

      body {
        margin: 0;
        padding: 0;
        background: linear-gradient(
          135deg,
          #0a0d1f 0%,
          #1a1a2e 50%,
          #16213e 100%
        );
        color: white;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        min-height: 100vh;
        padding-top: 120px;
      }
    </style>

    <nav class="navbar">
      <div class="logoContainer">
        <div class="logoCircle">üåå</div>
        <div class="logoSlogan">Exora - Exploring Pathways Beyond</div>
      </div>
      <ul class="navLinks">
        <li><a href="http://localhost:5173/" class="nav-link">Home</a></li>
        <li><a href="/starmap" class="nav-link">Star Map</a></li>
        <li>
          <a href="/discovery-trends" class="nav-link active"
            >Discovery Trends</a>
        </li>
        <li><a href="/orbital-viewer" class="nav-link">Orbital Viewer</a></li>
        <li><a href="/planet-explorer" class="nav-link">Planet Explorer</a></li>
        <li>
          <a href="http://localhost:5173/radial-velocity" class="nav-link">RV Analysis</a>
        </li>
        <li>
          <a href="/predict">AI Predict</a>
        </li>
      </ul>
    </nav>

    <main class="main-content">
      <div class="page-header">
        <h1>üìä Exoplanet Discovery Trends</h1>
        <p>
          Analyze patterns and statistics in exoplanet discoveries over time
        </p>
      </div>

      <div class="stats-summary">
        <div class="summary-card">
          <div class="summary-icon">üåç</div>
          <div class="summary-content">
            <h3 id="total-discoveries">Loading...</h3>
            <p>Total Confirmed Exoplanets</p>
          </div>
        </div>
        <div class="summary-card">
          <div class="summary-icon">üìÖ</div>
          <div class="summary-content">
            <h3 id="peak-year">Loading...</h3>
            <p>Peak Discovery Year</p>
          </div>
        </div>
        <div class="summary-card">
          <div class="summary-icon">üî¨</div>
          <div class="summary-content">
            <h3 id="top-method">Loading...</h3>
            <p>Most Common Method</p>
          </div>
        </div>
        <div class="summary-card">
          <div class="summary-icon">‚≠ê</div>
          <div class="summary-content">
            <h3 id="discovery-span">Loading...</h3>
            <p>Years of Discovery</p>
          </div>
        </div>
      </div>

      <div class="charts-grid">
        <div class="chart-container">
          <div class="chart-header">
            <h2>üìà Discoveries Over Time</h2>
            <p>Number of exoplanets discovered each year</p>
          </div>
          <div id="timeline-chart"></div>
        </div>

        <div class="chart-container">
          <div class="chart-header">
            <h2>üîç Discovery Methods</h2>
            <p>Distribution of detection techniques used</p>
          </div>
          <div id="methods-chart"></div>
        </div>

        <div class="chart-container">
          <div class="chart-header">
            <h2>üìè Planet Size Distribution</h2>
            <p>Size categories compared to Earth and Jupiter</p>
          </div>
          <div id="sizes-chart"></div>
        </div>

        <div class="chart-container">
          <div class="chart-header">
            <h2>üìä Cumulative Discoveries</h2>
            <p>Total number of confirmed exoplanets over time</p>
          </div>
          <div id="cumulative-chart"></div>
        </div>
      </div>

      <div class="insights-section">
        <h2>üß† Key Insights</h2>
        <div class="insights-grid">
          <div class="insight-card">
            <h3>üöÄ Transit Method Dominance</h3>
            <p>
              The transit photometry method, particularly from space-based
              missions like Kepler and TESS, has revolutionized exoplanet
              discovery by detecting periodic dimming as planets pass in front
              of their stars.
            </p>
          </div>
          <div class="insight-card">
            <h3>üìä Discovery Acceleration</h3>
            <p>
              The rate of exoplanet discovery has dramatically increased since
              2009 with the launch of the Kepler Space Telescope, leading to
              thousands of confirmed planets.
            </p>
          </div>
          <div class="insight-card">
            <h3>üåç Size Diversity</h3>
            <p>
              Exoplanets show incredible diversity in size, from smaller than
              Earth to larger than Jupiter, with many "super-Earths" and
              "mini-Neptunes" having no analog in our solar system.
            </p>
          </div>
          <div class="insight-card">
            <h3>üî¨ Multiple Methods</h3>
            <p>
              Different detection methods reveal different types of planets:
              radial velocity finds massive close-in planets, while transit
              photometry can detect smaller, more distant worlds.
            </p>
          </div>
        </div>
      </div>

      <div class="method-explanations">
        <h2>üîç Detection Methods Explained</h2>
        <div class="methods-grid">
          <div class="method-card">
            <h4>Transit Photometry</h4>
            <p>
              Detects planets by measuring the slight dimming of starlight when
              a planet passes in front of its host star. This method can
              determine planet size and orbital period.
            </p>
          </div>
          <div class="method-card">
            <h4>Radial Velocity</h4>
            <p>
              Measures the wobble in a star's motion caused by the gravitational
              pull of orbiting planets. This reveals planet mass and orbital
              characteristics.
            </p>
          </div>
          <div class="method-card">
            <h4>Direct Imaging</h4>
            <p>
              Directly photographs exoplanets by blocking out the bright light
              of the host star. This method works best for large, young, hot
              planets far from their stars.
            </p>
          </div>
          <div class="method-card">
            <h4>Gravitational Microlensing</h4>
            <p>
              Uses the gravitational field of a star to magnify light from a
              background star. If the lensing star has planets, they create
              additional magnification spikes.
            </p>
          </div>
        </div>
      </div>
    </main>

    <script>
      let discoveryData = {};
      let methodsData = {};
      let sizesData = {};

      document.addEventListener("DOMContentLoaded", function () {
        loadAllData();
      });

      async function loadAllData() {
        try {
          // Load all data in parallel
          const [statsResponse, methodsResponse, sizesResponse] =
            await Promise.all([
              fetch("/api/discovery-stats"),
              fetch("/api/discovery-methods"),
              fetch("/api/planet-sizes"),
            ]);

          discoveryData = await statsResponse.json();
          methodsData = await methodsResponse.json();
          sizesData = await sizesResponse.json();

          // Update summary statistics
          updateSummaryStats();

          // Create all charts
          createTimelineChart();
          createMethodsChart();
          createSizesChart();
          createCumulativeChart();
        } catch (error) {
          console.error("Error loading data:", error);
          showErrorMessage();
        }
      }

      function updateSummaryStats() {
        document.getElementById("total-discoveries").textContent =
          discoveryData.total_planets || "N/A";
        document.getElementById("peak-year").textContent =
          discoveryData.peak_year || "N/A";

        // Find the most common method
        if (methodsData.methods && methodsData.counts) {
          const maxIndex = methodsData.counts.indexOf(
            Math.max(...methodsData.counts)
          );
          document.getElementById("top-method").textContent =
            methodsData.methods[maxIndex] || "N/A";
        }

        document.getElementById("discovery-span").textContent =
          discoveryData.total_years || "N/A";
      }

      function createTimelineChart() {
        const trace = {
          x: discoveryData.years,
          y: discoveryData.counts,
          type: "scatter",
          mode: "lines+markers",
          name: "Annual Discoveries",
          line: {
            color: "#4f46e5",
            width: 3,
            shape: "spline",
          },
          marker: {
            size: 8,
            color: "#4f46e5",
            line: { color: "white", width: 2 },
          },
          fill: "tonexty",
          fillcolor: "rgba(79, 70, 229, 0.1)",
        };

        const layout = {
          title: {
            text: "Exoplanet Discoveries by Year",
            font: { size: 18 },
          },
          xaxis: {
            title: "Year",
            gridcolor: "rgba(128, 128, 128, 0.2)",
          },
          yaxis: {
            title: "Number of Discoveries",
            gridcolor: "rgba(128, 128, 128, 0.2)",
          },
          margin: { t: 50, r: 30, b: 60, l: 60 },
          height: 400,
          plot_bgcolor: "rgba(0,0,0,0)",
          paper_bgcolor: "rgba(0,0,0,0)",
          font: { family: "Arial, sans-serif" },
        };

        Plotly.newPlot("timeline-chart", [trace], layout, { responsive: true });
      }

      function createMethodsChart() {
        const trace = {
          labels: methodsData.methods,
          values: methodsData.counts,
          type: "pie",
          hole: 0.4,
          marker: {
            colors: [
              "#4f46e5",
              "#06b6d4",
              "#10b981",
              "#f59e0b",
              "#ef4444",
              "#8b5cf6",
              "#f97316",
            ],
            line: { color: "white", width: 2 },
          },
          textinfo: "label+percent",
          textfont: { size: 12 },
        };

        const layout = {
          title: {
            text: "Detection Methods Distribution",
            font: { size: 18 },
          },
          margin: { t: 50, r: 30, b: 30, l: 30 },
          height: 400,
          plot_bgcolor: "rgba(0,0,0,0)",
          paper_bgcolor: "rgba(0,0,0,0)",
          showlegend: true,
          legend: {
            orientation: "v",
            x: 1.02,
            y: 0.5,
          },
        };

        Plotly.newPlot("methods-chart", [trace], layout, { responsive: true });
      }

      function createSizesChart() {
        const trace = {
          x: sizesData.categories,
          y: sizesData.counts,
          type: "bar",
          marker: {
            color: ["#10b981", "#06b6d4", "#f59e0b", "#ef4444"],
            line: { color: "white", width: 2 },
          },
          text: sizesData.counts,
          textposition: "outside",
        };

        const layout = {
          title: {
            text: "Planet Size Categories",
            font: { size: 18 },
          },
          xaxis: {
            title: "Size Category",
            tickangle: -45,
          },
          yaxis: {
            title: "Number of Planets",
            gridcolor: "rgba(128, 128, 128, 0.2)",
          },
          margin: { t: 50, r: 30, b: 100, l: 60 },
          height: 400,
          plot_bgcolor: "rgba(0,0,0,0)",
          paper_bgcolor: "rgba(0,0,0,0)",
        };

        Plotly.newPlot("sizes-chart", [trace], layout, { responsive: true });
      }

      function createCumulativeChart() {
        // Calculate cumulative discoveries
        const cumulativeCounts = [];
        let total = 0;

        for (let count of discoveryData.counts) {
          total += count;
          cumulativeCounts.push(total);
        }

        const trace = {
          x: discoveryData.years,
          y: cumulativeCounts,
          type: "scatter",
          mode: "lines",
          name: "Cumulative Discoveries",
          line: {
            color: "#10b981",
            width: 4,
            shape: "spline",
          },
          fill: "tonexty",
          fillcolor: "rgba(16, 185, 129, 0.1)",
        };

        const layout = {
          title: {
            text: "Cumulative Exoplanet Discoveries",
            font: { size: 18 },
          },
          xaxis: {
            title: "Year",
            gridcolor: "rgba(128, 128, 128, 0.2)",
          },
          yaxis: {
            title: "Total Confirmed Planets",
            gridcolor: "rgba(128, 128, 128, 0.2)",
          },
          margin: { t: 50, r: 30, b: 60, l: 80 },
          height: 400,
          plot_bgcolor: "rgba(0,0,0,0)",
          paper_bgcolor: "rgba(0,0,0,0)",
        };

        Plotly.newPlot("cumulative-chart", [trace], layout, {
          responsive: true,
        });
      }

      function showErrorMessage() {
        document.getElementById("total-discoveries").textContent = "Error";
        document.getElementById("peak-year").textContent = "Error";
        document.getElementById("top-method").textContent = "Error";
        document.getElementById("discovery-span").textContent = "Error";

        // Show error message in charts
        const errorMessage = "Error loading data. Please refresh the page.";
        document.getElementById(
          "timeline-chart"
        ).innerHTML = `<p style="text-align: center; color: #ef4444; padding: 50px;">${errorMessage}</p>`;
        document.getElementById(
          "methods-chart"
        ).innerHTML = `<p style="text-align: center; color: #ef4444; padding: 50px;">${errorMessage}</p>`;
        document.getElementById(
          "sizes-chart"
        ).innerHTML = `<p style="text-align: center; color: #ef4444; padding: 50px;">${errorMessage}</p>`;
        document.getElementById(
          "cumulative-chart"
        ).innerHTML = `<p style="text-align: center; color: #ef4444; padding: 50px;">${errorMessage}</p>`;
      }
    </script>
  </body>
</html>
