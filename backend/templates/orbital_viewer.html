<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport"    <nav class="navbar">
      <div class="logoContainer">
        <div class="logoCircle">üåå</div>
        <div class="logoSlogan">Exora - Exploring Pathways Beyond</div>
      </div>
      <ul class="navLinks">
        <li><a href="http://localhost:5173/" class="nav-link">Home</a></li>
        <li><a href="/starmap" class="nav-link">Star Map</a></li>
        <li><a href="/discovery-trends" class="nav-link">Discovery Trends</a></li>
        <li><a href="/orbital-viewer" class="nav-link active">Orbital Viewer</a></li>
        <li><a href="/planet-explorer" class="nav-link">Planet Explorer</a></li>
        <li><a href="http://localhost:5173/radial-velocity" class="nav-link">RV Analysis</a></li>
      </ul>
    </nav>=device-width, initial-scale=1.0" />
    <title>3D Orbital Viewer - A World Away</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='css/style.css') }}"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  </head>
  <body>
    <style>
      /* Import React app header styles */
      :root {
        --color-dark-blue: #0A0D1F; 
        --color-text-white: #FFFFFF;
        --color-button: #007bff; 
      }

      .navbar {
        position: fixed;
        top: 0;
        left: 0;
        width: 95%;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 40px;
        background: rgba(10, 13, 31, 0.9);
        backdrop-filter: blur(10px);
        z-index: 100;
        border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      }

      .logoContainer {
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
      }

      .logoCircle {
        width: 60px;
        height: 60px;
        border: 2px solid var(--color-text-white);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
      }

      .logoSlogan {
        font-size: 0.7rem;
        margin-top: 5px;
        text-align: center;
        color: var(--color-text-white);
      }

      .navLinks {
        list-style: none;
        display: flex;
        gap: 30px;
        margin: 0;
        padding: 0;
      }

      .navLinks a {
        color: var(--color-text-white);
        text-decoration: none;
        font-size: 1.1rem;
        transition: color 0.3s;
        padding: 8px 16px;
        border-radius: 8px;
      }

      .navLinks a:hover {
        background: rgba(255, 255, 255, 0.1);
      }

      .navLinks a.active {
        background: rgba(0, 123, 255, 0.3);
        border: 1px solid rgba(0, 123, 255, 0.5);
      }



      body {
        margin: 0;
        padding: 0;
        background: linear-gradient(135deg, #0A0D1F 0%, #1a1a2e 50%, #16213e 100%);
        color: white;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        min-height: 100vh;
        padding-top: 120px;
      }
    </style>

    <nav class="navbar">
      <div class="logoContainer">
        <div class="logoCircle">
          ÔøΩ
        </div>
        <div class="logoSlogan">Exora - Orbital Viewer</div>
      </div>
      <ul class="navLinks">
        <li><a href="http://localhost:5173/" class="nav-link">Home</a></li>
        <li><a href="/starmap" class="nav-link">Star Map</a></li>
        <li><a href="/discovery-trends" class="nav-link">Discovery Trends</a></li>
        <li><a href="/orbital-viewer" class="nav-link active">Orbital Viewer</a></li>
        <li><a href="/planet-explorer" class="nav-link">Planet Explorer</a></li>
      </ul>
    </nav>

    <main class="main-content">
      <div class="page-header">
        <h1>üåç 3D Orbital Viewer</h1>
        <p>Visualize exoplanet orbits in three-dimensional space</p>
      </div>

      <div class="orbital-controls">
        <div class="control-section">
          <label for="planet-selector">Select Planet:</label>
          <select id="planet-selector">
            <option value="">Loading planets...</option>
          </select>
        </div>

        <div class="control-section">
          <label for="animation-speed">Animation Speed:</label>
          <input
            type="range"
            id="animation-speed"
            min="0"
            max="10"
            value="1"
            step="0.1"
          />
          <span id="speed-value">1.0x</span>
        </div>

        <div class="control-section">
          <button id="play-pause-btn" class="control-btn">‚è∏Ô∏è Pause</button>
          <button id="reset-view-btn" class="control-btn">üîÑ Reset View</button>
          <button id="toggle-labels-btn" class="control-btn">
            üè∑Ô∏è Toggle Labels
          </button>
        </div>
      </div>

      <div class="orbital-display">
        <div class="orbital-canvas-container">
          <div id="orbital-canvas"></div>
          <div class="canvas-instructions">
            <p>
              üñ±Ô∏è Mouse: Rotate view | üñ≤Ô∏è Wheel: Zoom | Click & Drag: Orbit
              camera
            </p>
          </div>
        </div>

        <div class="orbital-info-panel">
          <div class="info-header">
            <h3 id="current-planet-name">Select a planet</h3>
          </div>
          <div class="info-content">
            <div class="info-section">
              <h4>Orbital Parameters</h4>
              <div class="param-grid">
                <div class="param-item">
                  <label>Semi-major Axis:</label>
                  <span id="semi-major-axis">-</span>
                </div>
                <div class="param-item">
                  <label>Orbital Period:</label>
                  <span id="orbital-period">-</span>
                </div>
                <div class="param-item">
                  <label>Planet Radius:</label>
                  <span id="planet-radius">-</span>
                </div>
                <div class="param-item">
                  <label>Host Star:</label>
                  <span id="host-star">-</span>
                </div>
              </div>
            </div>

            <div class="info-section">
              <h4>Discovery Information</h4>
              <div class="param-grid">
                <div class="param-item">
                  <label>Discovery Year:</label>
                  <span id="discovery-year">-</span>
                </div>
                <div class="param-item">
                  <label>Detection Method:</label>
                  <span id="detection-method">-</span>
                </div>
                <div class="param-item">
                  <label>Temperature:</label>
                  <span id="equilibrium-temp">-</span>
                </div>
                <div class="param-item">
                  <label>Mass:</label>
                  <span id="planet-mass">-</span>
                </div>
              </div>
            </div>

            <div class="info-section">
              <h4>Scale Reference</h4>
              <div class="scale-reference">
                <div class="scale-item">
                  <div class="scale-color earth"></div>
                  <span>Earth (1 AU orbit)</span>
                </div>
                <div class="scale-item">
                  <div class="scale-color jupiter"></div>
                  <span>Jupiter (5.2 AU orbit)</span>
                </div>
                <div class="scale-item">
                  <div class="scale-color exoplanet"></div>
                  <span>Selected Exoplanet</span>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="orbital-education">
        <h2>üéì Understanding Orbital Mechanics</h2>
        <div class="education-grid">
          <div class="education-card">
            <h4>üåç Semi-major Axis</h4>
            <p>
              The average distance between a planet and its star, measured in
              Astronomical Units (AU). Earth's semi-major axis is 1 AU by
              definition.
            </p>
          </div>
          <div class="education-card">
            <h4>‚è∞ Orbital Period</h4>
            <p>
              The time it takes for a planet to complete one full orbit around
              its star. Earth's orbital period is 365.25 days (1 year).
            </p>
          </div>
          <div class="education-card">
            <h4>üìè Kepler's Third Law</h4>
            <p>
              The square of a planet's orbital period is proportional to the
              cube of its semi-major axis. This fundamental law governs all
              orbital motion.
            </p>
          </div>
          <div class="education-card">
            <h4>üî• Habitable Zone</h4>
            <p>
              The region around a star where liquid water could exist on a
              planet's surface. Also called the "Goldilocks zone" - not too hot,
              not too cold.
            </p>
          </div>
        </div>
      </div>
    </main>

    <script>
      let scene, camera, renderer;
      let star, planet, orbitPath, planetOrbit;
      let animationId;
      let isAnimating = true;
      let animationSpeed = 1.0;
      let currentPlanetData = null;
      let showLabels = true;
      let labels = [];

      document.addEventListener("DOMContentLoaded", function () {
        initOrbitalViewer();
        loadPlanetList();
        setupEventListeners();
      });

      function initOrbitalViewer() {
        const container = document.getElementById("orbital-canvas");
        const width = container.clientWidth;
        const height = 500;

        // Create scene
        scene = new THREE.Scene();
        scene.background = new THREE.Color(0x000008);

        // Create camera
        camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);
        camera.position.set(10, 10, 10);
        camera.lookAt(0, 0, 0);

        // Create renderer
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setSize(width, height);
        container.appendChild(renderer.domElement);

        // Add lights
        const ambientLight = new THREE.AmbientLight(0x404040, 0.3);
        scene.add(ambientLight);

        const pointLight = new THREE.PointLight(0xffffff, 1, 100);
        pointLight.position.set(0, 0, 0);
        scene.add(pointLight);

        // Add controls
        setupOrbitalControls();

        // Create default solar system reference
        createDefaultSystem();

        // Start animation
        animate();
      }

      function setupOrbitalControls() {
        const canvas = renderer.domElement;
        let isMouseDown = false;
        let mouseX = 0,
          mouseY = 0;
        let cameraRadius = 20;
        let cameraTheta = Math.PI / 4;
        let cameraPhi = Math.PI / 4;

        canvas.addEventListener("mousedown", (event) => {
          isMouseDown = true;
          mouseX = event.clientX;
          mouseY = event.clientY;
        });

        canvas.addEventListener("mouseup", () => {
          isMouseDown = false;
        });

        canvas.addEventListener("mousemove", (event) => {
          if (isMouseDown) {
            const deltaX = event.clientX - mouseX;
            const deltaY = event.clientY - mouseY;

            cameraTheta -= deltaX * 0.01;
            cameraPhi += deltaY * 0.01;

            // Limit vertical rotation
            cameraPhi = Math.max(0.1, Math.min(Math.PI - 0.1, cameraPhi));

            updateCameraPosition();

            mouseX = event.clientX;
            mouseY = event.clientY;
          }
        });

        canvas.addEventListener("wheel", (event) => {
          event.preventDefault();
          const delta = event.deltaY * 0.01;
          cameraRadius += delta;
          cameraRadius = Math.max(5, Math.min(100, cameraRadius));
          updateCameraPosition();
        });

        function updateCameraPosition() {
          camera.position.x =
            cameraRadius * Math.sin(cameraPhi) * Math.cos(cameraTheta);
          camera.position.y = cameraRadius * Math.cos(cameraPhi);
          camera.position.z =
            cameraRadius * Math.sin(cameraPhi) * Math.sin(cameraTheta);
          camera.lookAt(0, 0, 0);
        }
      }

      function createDefaultSystem() {
        // Create star (sun)
        const starGeometry = new THREE.SphereGeometry(1, 32, 32);
        const starMaterial = new THREE.MeshBasicMaterial({
          color: 0xffff00,
          emissive: 0xffff00,
          emissiveIntensity: 0.3,
        });
        star = new THREE.Mesh(starGeometry, starMaterial);
        scene.add(star);

        // Create Earth reference orbit
        createReferenceOrbits();
      }

      function createReferenceOrbits() {
        // Earth orbit (1 AU)
        const earthOrbitGeometry = new THREE.RingGeometry(5, 5.1, 64);
        const earthOrbitMaterial = new THREE.MeshBasicMaterial({
          color: 0x0088ff,
          side: THREE.DoubleSide,
          transparent: true,
          opacity: 0.3,
        });
        const earthOrbitRing = new THREE.Mesh(
          earthOrbitGeometry,
          earthOrbitMaterial
        );
        earthOrbitRing.rotation.x = Math.PI / 2;
        scene.add(earthOrbitRing);

        // Jupiter orbit (5.2 AU)
        const jupiterOrbitGeometry = new THREE.RingGeometry(15, 15.2, 64);
        const jupiterOrbitMaterial = new THREE.MeshBasicMaterial({
          color: 0xff8800,
          side: THREE.DoubleSide,
          transparent: true,
          opacity: 0.2,
        });
        const jupiterOrbitRing = new THREE.Mesh(
          jupiterOrbitGeometry,
          jupiterOrbitMaterial
        );
        jupiterOrbitRing.rotation.x = Math.PI / 2;
        scene.add(jupiterOrbitRing);
      }

      async function loadPlanetList() {
        try {
          const response = await fetch("/api/exoplanets?limit=50");
          const planets = await response.json();

          const selector = document.getElementById("planet-selector");
          selector.innerHTML = '<option value="">Select a planet...</option>';

          planets.forEach((planet) => {
            const option = document.createElement("option");
            option.value = planet.name;
            option.textContent = `${planet.name} (${planet.host_star})`;
            selector.appendChild(option);
          });
        } catch (error) {
          console.error("Error loading planet list:", error);
          document.getElementById("planet-selector").innerHTML =
            '<option value="">Error loading planets</option>';
        }
      }

      async function loadPlanetData(planetName) {
        if (!planetName) {
          clearPlanetVisualization();
          return;
        }

        try {
          const response = await fetch(
            `/api/orbital-data/${encodeURIComponent(planetName)}`
          );
          currentPlanetData = await response.json();

          updateInfoPanel(currentPlanetData);
          createPlanetVisualization(currentPlanetData);
        } catch (error) {
          console.error("Error loading planet data:", error);
          clearPlanetVisualization();
        }
      }

      function updateInfoPanel(planetData) {
        document.getElementById("current-planet-name").textContent =
          planetData.planet_name;
        document.getElementById(
          "semi-major-axis"
        ).textContent = `${planetData.semi_major_axis.toFixed(3)} AU`;
        document.getElementById(
          "orbital-period"
        ).textContent = `${planetData.orbital_period.toFixed(1)} days`;
        document.getElementById(
          "planet-radius"
        ).textContent = `${planetData.planet_radius.toFixed(2)} R‚äï`;
        document.getElementById("host-star").textContent = planetData.host_star;

        const props = planetData.planet_properties;
        document.getElementById("discovery-year").textContent =
          props.discovery_year || "Unknown";
        document.getElementById("detection-method").textContent =
          props.discovery_method || "Unknown";
        document.getElementById("equilibrium-temp").textContent =
          props.equilibrium_temp
            ? `${props.equilibrium_temp.toFixed(0)} K`
            : "Unknown";
        document.getElementById("planet-mass").textContent = props.mass
          ? `${props.mass.toFixed(2)} M‚äï`
          : "Unknown";
      }

      function createPlanetVisualization(planetData) {
        // Clear existing planet and orbit
        clearPlanetVisualization();

        const semiMajorAxis = planetData.semi_major_axis * 5; // Scale for visualization
        const planetRadius = Math.max(0.1, planetData.planet_radius * 0.2); // Scale planet size

        // Create orbit path
        const orbitGeometry = new THREE.RingGeometry(
          semiMajorAxis - 0.05,
          semiMajorAxis + 0.05,
          64
        );
        const orbitMaterial = new THREE.MeshBasicMaterial({
          color: 0x00ff88,
          side: THREE.DoubleSide,
          transparent: true,
          opacity: 0.5,
        });
        orbitPath = new THREE.Mesh(orbitGeometry, orbitMaterial);
        orbitPath.rotation.x = Math.PI / 2;
        scene.add(orbitPath);

        // Create planet
        const planetGeometry = new THREE.SphereGeometry(planetRadius, 16, 16);
        const planetMaterial = new THREE.MeshLambertMaterial({
          color: 0x00ff88,
        });
        planet = new THREE.Mesh(planetGeometry, planetMaterial);
        scene.add(planet);

        // Create planet orbit object for animation
        planetOrbit = {
          radius: semiMajorAxis,
          period: planetData.orbital_period,
          angle: 0,
        };
      }

      function clearPlanetVisualization() {
        if (planet) {
          scene.remove(planet);
          planet = null;
        }
        if (orbitPath) {
          scene.remove(orbitPath);
          orbitPath = null;
        }
        planetOrbit = null;
      }

      function animate() {
        animationId = requestAnimationFrame(animate);

        // Animate planet orbit
        if (planet && planetOrbit && isAnimating) {
          planetOrbit.angle +=
            animationSpeed * 0.01 * (365.25 / planetOrbit.period);

          planet.position.x = planetOrbit.radius * Math.cos(planetOrbit.angle);
          planet.position.z = planetOrbit.radius * Math.sin(planetOrbit.angle);
          planet.position.y = 0;
        }

        // Rotate star
        if (star) {
          star.rotation.y += 0.005;
        }

        renderer.render(scene, camera);
      }

      function setupEventListeners() {
        document
          .getElementById("planet-selector")
          .addEventListener("change", function () {
            loadPlanetData(this.value);
          });

        document
          .getElementById("animation-speed")
          .addEventListener("input", function () {
            animationSpeed = parseFloat(this.value);
            document.getElementById(
              "speed-value"
            ).textContent = `${animationSpeed.toFixed(1)}x`;
          });

        document
          .getElementById("play-pause-btn")
          .addEventListener("click", function () {
            isAnimating = !isAnimating;
            this.textContent = isAnimating ? "‚è∏Ô∏è Pause" : "‚ñ∂Ô∏è Play";
          });

        document
          .getElementById("reset-view-btn")
          .addEventListener("click", function () {
            camera.position.set(10, 10, 10);
            camera.lookAt(0, 0, 0);
          });

        document
          .getElementById("toggle-labels-btn")
          .addEventListener("click", function () {
            showLabels = !showLabels;
            // Toggle label visibility logic would go here
            this.textContent = showLabels ? "üè∑Ô∏è Hide Labels" : "üè∑Ô∏è Show Labels";
          });
      }

      // Handle window resize
      window.addEventListener("resize", function () {
        const container = document.getElementById("orbital-canvas");
        const width = container.clientWidth;
        const height = 500;

        camera.aspect = width / height;
        camera.updateProjectionMatrix();
        renderer.setSize(width, height);
      });
    </script>
  </body>
</html>
